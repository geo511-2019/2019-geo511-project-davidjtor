---
title: "GEO 511: Spatial Data Science Project"
author: David Torgerson
subtitle: Contributing to the National Phenology Network
code_folding: hide
---

# Introduction
For my project, I'm looking at ecological data, specifically about a variety of different tree species. The data is collected from an undergraduate ecology course about a variety of tree species around campus. This data contributes to an overarching phenological problem regarding carbon emissions and the rate at which leaves fall off the tree. I'm building some graphs that show some interesting aspects of trees and their leaves. Since the National Phenology Network uses data provided from Citizen Scientists, I'm going to look at the implications of using their data for analysis while also doing some analysis regarding the different species of trees around campus. 

# Materials and methods

Narrative and most code will go here.  Describe what you are doing and show how to do it (with code).

* Install/Download the appropriate libraries
* Retrieve the data that is stored online using UB's network ID.
* Pull the two data sources together and perform some exploratory analysis.
* Create some tables that can be used for analysis.
* Generate some graphs that show some interesting finds about the data.

Load all packages (you may need to install some packages):

```{r, message=F, warning=F, echo=TRUE}
library(tidyverse)
library(rnpn)
library(dplyr)
library(lubridate)
library(leaflet)
library(readxl)
library(sf)
library(spData)
library(ggmap)
library(kableExtra)
library(knitr)
library(data.table)
library(broom)
library(widgetframe)
library(DT)
knitr::opts_chunk$set(cache=TRUE)  ##cache the results for quick compiling
```

## Download and clean all required data
```{r, warning=FALSE, message=FALSE}
d=npn_download_status_data("Testing",
                           years=c('2019'),
                           additional_fields=list("Plant_Nickname",
                                                  "ObservedBy_Person_ID"),
                           network_ids=c(891))

d_filtered <- d %>%
  rename("a"="intensity_value") %>% 
  mutate(
    date = as.Date(observation_date),
    month = month(date),
    tag = as.numeric(substr(plant_nickname,1,3)),
    intensity=case_when(
      a == "Less than 5%" ~ 2.5,
      a == "Less than 25%" ~ 20,
      a == "5-24%" ~ 14.5,
      a == "25-49%" ~ 37,
      a == "50-74%" ~ 62,
      a == "75-94%" ~ 84.5,
      a == "95% or more"  ~ 97.5,
      a == "Less than 3"  ~ 2,  
      a == "3 to 10" ~ 6.5,
      a == "11 to 100" ~ 50,
      a == "101 to 1,000" ~ 500,
      a == "1,001 to 10,000" ~ 5000,
      a == "Little" ~ 5,
      a == "Some" ~ 3,  
      TRUE ~ as.numeric(NA)
    ))%>%
  filter(phenophase_description%in%c("Leaves","Colored leaves"))

d_filtered <- d_filtered %>%
  mutate(leaf_drop = case_when(
    intensity < 50 ~ "Dropped",
    intensity >= 50 ~ "Not Dropped"
  ))

trees <- read_csv("trees.csv")

trees <- trees %>% 
  mutate(color = case_when (
    common_name == "Red Oak" ~ "red",
    common_name == "Black Oak" ~ "black",
    common_name == "Silver Maple" ~ "darkblue",
    common_name == "Red Maple" ~ "orange",
    common_name == "Black Locust" ~ "purple",
    common_name == "Sugar Maple" ~ "darkpurple",
    common_name == "Staghorn Sumac" ~ "blue",
    common_name == "Eastern Cottonwood" ~ "beige",
    common_name == "Apple" ~ "yellow",
    common_name == "American Basswood" ~ "pink",
    common_name == "River Birch" ~ "lightred",
    common_name == "White Birch" ~ "cadetblue",
    common_name == "Ginkgo" ~ "lightgray"
  ))
```

# Exploratory Data Analysis
```{r,warning=FALSE, message=FALSE, results='asis'}
table <- prop.table(table(d$common_name)) * 100
table %>%
  kable(col.names = c("Common Name","Percentage of Observations"), digits = 2) %>% kable_styling(full_width = FALSE, fixed_thead = TRUE) %>%
  scroll_box(width = "500px", height = "200px", fixed_thead = TRUE)
##The table above shows the percentage of observations of each tree.
d_filtered %>%
  group_by(tag) %>%
  summarize(var_intensity = var(intensity,na.rm = TRUE),
            mean_intensity = mean(intensity, na.rm = TRUE)) %>%
  filter(var_intensity != 0) %>%
  kable(digits = 2, col.names = c("Tag ID","Intensity Variance","Intensity Average")) %>% kable_styling() %>% scroll_box(width = "500px", height = "200px")
##The above looks at the mean and variance of each tagged tree.
d_filtered %>%
  group_by(tag,observedby_person_id) %>%
  summarize(var_intensity = var(intensity,na.rm = TRUE)) %>%
  filter(var_intensity != 0) %>%
  kable(digits = 2,
        col.names = c("Tag ID","Person ID","Intensity Variance")) %>%
  kable_styling() %>%
  scroll_box(width = "500px", height = "200px")
#This table is just to show how much variability there is in Citizen Science.
```
# Results

```{r, fig.width=6, fig.height=3, fig.cap="Map of completely random data"}
##Making Icons
icons <- awesomeIcons(
  icon = 'ios-close',
  iconColor = 'white',
  library = 'ion',
  markerColor = trees$color)

##Interactive Leaflet Map
leaflet(trees) %>% 
  addTiles() %>%
  addAwesomeMarkers(~lon, ~lat,
                    icon=icons,
                    label = paste("Tag:", trees$tag, "|",
                    "Species:", trees$common_name))
```


```{r, warning=FALSE}
d_filtered %>%
  filter(month >= 8) %>%
  ggplot(aes(x = month, y = intensity, color = leaf_drop)) +
  geom_point() +
  geom_smooth() +
  facet_wrap(~ common_name)

ggplot(d_filtered, aes(x = common_name, fill = common_name)) +
  geom_bar(position = "dodge") +
  ylab("Count of Observations") +
  xlab("Species") +
  coord_flip()

##This code was generated by Professor Wilson
d_filtered %>% 
  filter(month >= 8) %>%
  ggplot(aes(x=date,
             y=intensity,
             group=phenophase_description,
             col=phenophase_description))+
  geom_point()+
  facet_wrap(~common_name)+
  ylim(0,100)+
  geom_smooth(span=3)
```

# Conclusions
In the data, we are able to see that in Citizen Science, there can be a lot of variability in observations. It's interesting to see how data is collected from other individuals and how it contributes to a bigger picture. We can see from the graphs that although most leaves typically drop around October, some trees don't drop their leaves until much later in the year. Citizen Science is very useful in terms of getting young scientists involved and helping to contribute data to solving a bigger problem. One of the main drawbacks of using citizen science data is the large variation in observations as shown in the table above. Even looking at one particular tag, we can see the huge amount of variation in observations between the different participants. 


# References
