---
title: "GEO 511: Spatial Data Science Project"
author: David Torgerson
subtitle: Contributing to the National Phenology Network
---

# Introduction
For my project, I'm looking at ecological data, specifically about a variety of different tree species. The data is collected from an undergraduate ecology course about a variety of tree species around campus. This data contributes to an overarching phenological problem regarding carbon emissions and the rate at which leaves fall off the tree. I'm building some graphs that show some interesting aspects of trees and their leaves. I'm also in the process of building an interactive map that shows the species and data about that specific tree. 

# Materials and methods

Narrative and most code will go here.  Describe what you are doing and show how to do it (with code).

* First, I had to retrieve the data that is stored online.
* Next, I had to pull the two data sources together and perform some exploratory analysis.
* Next, I generated some graphs that show some interesting finds about the data.

Load any required packages in a code chunk (you may need to install some packages):

```{r, message=F, warning=F, echo=TRUE}
library(tidyverse)
library(rnpn)
library(dplyr)
library(lubridate)
library(leaflet)
library(readxl)
library(sf)
library(spData)
library(ggmap)
library(kableExtra)
knitr::opts_chunk$set(cache=TRUE)  # cache the results for quick compiling
```

## Download and clean all required data
```{r}
d <- npn_download_status_data("Your Name",
                              years=c('2019'),
                              network_ids=c(891))

d_filtered <- d %>%
  rename("a"="intensity_value") %>% 
  mutate(
    date=as.Date(observation_date),
    month = month(date),
    intensity=case_when(
      a == "Less than 5%" ~ 2.5,
      a == "Less than 25%" ~ 20,
      a == "5-24%" ~ 14.5,
      a == "25-49%" ~ 37,
      a == "50-74%" ~ 62,
      a == "75-94%" ~ 84.5,
      a == "95% or more"  ~ 97.5,
      a == "Less than 3"  ~ 2,  
      a == "3 to 10" ~ 6.5,
      a == "11 to 100" ~ 50,
      a == "101 to 1,000" ~ 500,
      a == "1,001 to 10,000" ~ 5000,
      a == "Little" ~ 5,
      a == "Some" ~ 3,  
      TRUE ~ as.numeric(NA)
    ))%>%
  filter(phenophase_description%in%c("Leaves","Colored leaves"))

d_filtered <- d_filtered %>%
  mutate(leaf_drop = case_when(
    intensity < 50 ~ "Dropped",
    intensity >= 50 ~ "Not Dropped"
  ))

trees <- read_csv("trees.csv")
```

# Results

```{r, fig.width=6, fig.height=3, fig.cap="Map of completely random data"}
leaflet() %>%
  addTiles() %>%
 ## addPolygons(data = state, fillColor = "NA", color = "NA") %>%
  addCircleMarkers(data = trees, ~lon, ~lat, popup = ~common_name)
```


```{r}
d_filtered %>%
  ggplot(aes(x = date, y = intensity, color = leaf_drop)) +
  geom_point() +
  geom_smooth() +
  facet_wrap(~ common_name)

ggplot(d_filtered, aes(x = species, fill = species)) +
  geom_bar(position = "dodge") +
  ylab("Count of Observations") +
  xlab("Species")

#This code was generated by Professor Wilson
d_filtered %>% 
  ggplot(aes(x=date,
             y=intensity,
             group=phenophase_description,
             col=phenophase_description))+
  geom_point()+
  facet_wrap(~common_name)+
  ylim(0,100)+
  geom_smooth(span=3)
```

# Conclusions



# References
